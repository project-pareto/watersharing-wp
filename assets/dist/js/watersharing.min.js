!function(t){function a(){t("table.tablesorter").each((function(){var a=t(this).attr("id");t("#"+a).tablesorter().bind("sortEnd",(function(e,n){t("#"+a+" .row-summary").each((function(){var e=t(this),n=e.data("row-number"),s=t("#"+a+" .row-expanded[data-row-number='"+n+"']");e.after(s)}))}))}))}t(".geoentry").on("input",(function(){var a=t(this).val();a=(a=a.replace(/[^0-9.-]/g,"")).replace(/^0+/,""),t(this).val(a)})),t(document).on("click","input.watersharing-input-row",(function(){!function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=document.querySelectorAll('input[type="checkbox"]'),e=document.getElementById(t+"-status-submit"),n=0;n<a.length;n++)if(a[n].checked)return void(e.disabled=!1);e.disabled=!0}(t(this).data("watershare-type"))})),t(document).on("click",".post-status-submit",(function(a){t(this);var e=t(this).prev("select").val();""===e||null===e?(a.preventDefault(),alert("Please select an action")):confirm("Are you sure you want to "+e+" your request(s)?")||a.preventDefault()})),t(document).on("input","#start_date",(function(){var a=t(this),e=t(this).parent().parent().find(".end-dp #end_date");t(e).val(""),t(e).attr("min",t(a).val()),t(e).prop("disabled",!1)})),t(document).on("blur","#end_date",(function(){t(this).val()<t(this).parent().parent().find(".start-dp #start_date").val()&&(alert("End date cannot be before the start date."),endDateInput.val(""))})),t(document).on("blur","input#longitude, input#latitude",(function(){var a=t(this).closest("form"),e=a.find("input#longitude"),n=a.find("input#latitude"),s=parseFloat(e.val()),o=parseFloat(n.val());isNaN(s)||isNaN(o)||(s<-124.785543||s>-66.945554||o<24.446667||o>49.382812)&&(alert("Coordinates must fall within continental USA"),e.val(""),n.val(""))})),t(document).on("click",".toggle-row",(function(){if(t(this).closest("tr").next("tr").hasClass("show")){t(this).toggleClass("active"),t(this).closest("tr").next("tr").removeClass("show"),t(this).closest("tr").next("tr").addClass("collapsing");var a=t(this);setTimeout((function(a){t(a).closest("tr").next("tr").removeClass("collapsing"),t(a).closest("tr").next("tr").addClass("collapse")}),400,a)}else t(".toggle-row").each((function(){if(t(this).closest("tr").next("tr").hasClass("show")){t(this).toggleClass("active"),t(this).closest("tr").next("tr").removeClass("show"),t(this).closest("tr").next("tr").addClass("collapsing");var a=t(this);setTimeout((function(a){t(a).closest("tr").next("tr").removeClass("collapsing"),t(a).closest("tr").next("tr").addClass("collapse")}),400,a)}})),t(this).toggleClass("active"),t(this).closest("tr").next("tr").removeClass("collapse"),t(this).closest("tr").next("tr").addClass("collapsing"),a=t(this),setTimeout((function(a){t(a).closest("tr").next("tr").removeClass("collapsing"),t(a).closest("tr").next("tr").addClass("show")}),100,a)})),t(document).on("change",'select[name="well_pad"]',(function(){t(this).val();var a=t(this).find(":selected").data("lat"),e=t(this).find(":selected").data("long"),n=t(this).find(":selected").data("title");t("input#well_name").val(n),t("input#latitude").val(a),t("input#longitude").val(e),t("input#well_name").addClass("readonly"),t("input#latitude").addClass("readonly"),t("input#longitude").addClass("readonly")})),t(document).on("click","a.approval",(function(){var e="#"+t(this).data("table");e=t(e).parent();var n=[];n.lookupid=t(this).data("lookup"),n.matchid=t(this).data("match"),n.parentid=t(this).data("parent"),n.interaction=t(this).data("action"),n.interactiontype=t(this).data("match-type"),n.dataTable=e,n.rowOpen=t(this).parents().eq(7).data("row-number"),confirm("Are you sure you want to "+n.interaction+" this match?")&&function(e){var n=e.dataTable.find("table").attr("id").split("-")[0];t("."+n+"-loading-indicator").show(),t.ajax({url:"/wp-admin/admin-ajax.php",type:"POST",data:{action:"ajax_approval",lookup_record:e.lookupid,parent_record:e.parentid,match_record:e.matchid,action_status:e.interaction,action_type:e.interactiontype},dataType:"json",beforeSend:function(a){t(e.dataTable).html("")},success:function(n){console.log(n),t(e.dataTable).html(n),a()},complete:function(a){t("."+n+"-loading-indicator").hide()},error:function(a){t("."+n+"-loading-indicator").hide()}})}(n)})),t(document).ready((function(){a()})),t(document).ready((function(){function a(t,a){t.hasClass("collapsing")&&!t.hasClass("show-initial")||(console.log("Checks passes to Hide collapse"),t.css("height",t[0].scrollHeight+"px").removeClass("collapse show show-initial").addClass("collapsing"),t[0].offsetHeight,t.css("height",0).one("transitionend",(function(){t.removeClass("collapsing").addClass("collapse").css("height","")})),a.addClass("collapsed").attr("aria-expanded",!1),console.log("Collapse complete hidden:",t))}function e(t){return t.replace(/\B(?=(\d{3})+(?!\d))/g,",")}t(".accordion-button").on("click",(function(){var e=t(this).attr("data-bs-target"),n=t(e),s=t(this);n.hasClass("show")||n.hasClass("show-initial")?a(n,s):(function(t,a){if(!t.hasClass("collapsing")&&!t.hasClass("show")&&!t.hasClass("show-initial")){t.removeClass("collapse").addClass("collapsing").css("height",0),t[0].offsetHeight;var e=t[0].scrollHeight;t.css("height",e+"px").one("transitionend",(function(){t.removeClass("collapsing").addClass("collapse show").css("height","")})),a.removeClass("collapsed").attr("aria-expanded",!0)}}(n,s),function(e){t(".accordion-collapse").not(e).each((function(){var e=t(this),n=t('[data-bs-target="#'+e.attr("id")+'"]');e&&n&&a(e,n)}))}(n))})),t(".checkbox").change((function(){var a=t(this).is(":checked");t(this).closest(".watersharing-row").find('input[type="number"]').prop("disabled",!a)})),t(".checkbox").each((function(){var a=t(this).attr("class").split(" ").find((function(t){return t.includes("trade_supply")||t.includes("trade_demand")}));a&&t(this).closest(".watersharing-row").find('input[type="number"][class*="'.concat(a.split("-")[0],'"]')).prop("disabled",!0)})),t(".trade_supply-bid_amount, .trade_supply-rate_bpd, .trade_supply-bid_units, .trade_demand-bid_amount, .trade_demand-rate_bpd, .trade_demand-bid_units").change((function(){var a=t(this).hasClass("trade_supply-bid_amount")||t(this).hasClass("trade_supply-rate_bpd")||t(this).hasClass("trade_supply-bid_units")?"trade_supply-":"trade_demand-",n=t("."+a+"bid_amount"),s=t("."+a+"rate_bpd"),o=t("."+a+"bid_units"),i=t("."+a+"totalval"),l=t("."+a+"specval"),r=parseFloat(n.val()),d=parseFloat(s.val()),c=o.val();isNaN(r)||isNaN(d)||null==c?(i.val(""),l.val("")):"USD/bbl.day"==c?(i.val(e((r*d).toFixed(2))),l.val(e(r.toFixed(2)))):(i.val(e(r.toFixed(2))),l.val(e((r/d).toFixed(2))))}))})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".chart-container").forEach((function(t){var a=t.getAttribute("data-block-id"),e=JSON.parse(t.getAttribute("data-chart-data")),n=document.getElementById("stat-chart-".concat(a));if(n&&e){var s=n.getContext("2d"),o=e.map((function(t){return t.volume})),i=e.map((function(t){return t.date}));new Chart(s,{type:"line",data:{labels:i,datasets:[{label:"Ongoing trades",data:o,borderWidth:1}]},options:{scales:{y:{beginAtZero:!0,title:{display:!0,text:"Volume(bbl)"}}},plugins:{legend:{display:!1},title:{display:!0,text:"Ongoing Trades",font:{size:20,weight:"bold"}},tooltip:{enabled:!1}},responsive:!0,maintainAspectRatio:!1}})}})),t(document).on("click",".download-summary-btn",(function(a){a.preventDefault();var e=t(this).data("tradeCsv");t.ajax({url:my_ajax_object.ajax_url,method:"POST",data:{action:"download_latest_summary",trade_csv:e},xhrFields:{responseType:"blob"},success:function(t){if(t instanceof Blob&&t.size){var a=window.URL.createObjectURL(t),n=document.createElement("a");n.style.display="none",n.href=a,n.download=e+" Summary.csv",document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(a)}else console.error("Invalid or empty Blob response:",t),alert("The file could not be downloaded.")},error:function(t,a,e){console.error("AJAX error:",a,e),alert("Could not download the file. May be missing or empty, please try again.")}})})),jQuery})),window.downloadCsv=function(t,a){var e=new FormData;e.append("action","download_csv"),e.append("csv_data",JSON.stringify(a)),fetch(t,{method:"POST",body:e}).then((function(t){if(t.ok)return t.blob();throw new Error("Network response was not ok.")})).then((function(t){var a=window.URL.createObjectURL(t),e=document.createElement("a");e.style.display="none",e.href=a,e.download="trades_data.csv",document.body.appendChild(e),e.click(),window.URL.revokeObjectURL(a)})).catch((function(t){return console.error("There was an error with the download:",t)}))}}(jQuery);