(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}!function(e){function a(){e("table.tablesorter").each((function(){var t=e(this).attr("id");e("#"+t).tablesorter().bind("sortEnd",(function(a,o){e("#"+t+" .row-summary").each((function(){var a=e(this),o=a.data("row-number"),n=e("#"+t+" .row-expanded[data-row-number='"+o+"']");a.after(n)}))}))}))}e(".geoentry").on("input",(function(){var t=e(this).val();t=(t=t.replace(/[^0-9.-]/g,"")).replace(/^0+/,""),e(this).val(t)})),e(document).on("click","input.watersharing-input-row",(function(){!function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=document.querySelectorAll('input[type="checkbox"]'),a=document.getElementById(t+"-status-submit"),o=0;o<e.length;o++)if(e[o].checked)return void(a.disabled=!1);a.disabled=!0}(e(this).data("watershare-type"))})),e(document).on("click",".post-status-submit",(function(t){e(this);var a=e(this).prev("select").val();""===a||null===a?(t.preventDefault(),alert("Please select an action")):confirm("Are you sure you want to "+a+" your request(s)?")||t.preventDefault()})),e(document).on("input","#start_date",(function(){var t=e(this),a=e(this).parent().parent().find(".end-dp #end_date");e(a).val(""),e(a).attr("min",e(t).val()),e(a).prop("disabled",!1)})),e(document).on("blur","#end_date",(function(){e(this).val()<e(this).parent().parent().find(".start-dp #start_date").val()&&(alert("End date cannot be before the start date."),endDateInput.val(""))})),e(document).on("blur","input#longitude, input#latitude",(function(){var t=e(this).closest("form"),a=t.find("input#longitude"),o=t.find("input#latitude"),n=parseFloat(a.val()),s=parseFloat(o.val());isNaN(n)||isNaN(s)||(n<-124.785543||n>-66.945554||s<24.446667||s>49.382812)&&(alert("Coordinates must fall within continental USA"),a.val(""),o.val(""))})),e(document).on("click",".create-post-submit-button",(function(t){e(this).closest("form").find("[required]").filter((function(){return""===e(this).val().trim()})).length>0&&alert("Please fill in all required fields in the Primary Information section.")})),e(document).on("click",".toggle-row",(function(){if(e(this).closest("tr").next("tr").hasClass("show")){e(this).toggleClass("active"),e(this).closest("tr").next("tr").removeClass("show"),e(this).closest("tr").next("tr").addClass("collapsing");var t=e(this);setTimeout((function(t){e(t).closest("tr").next("tr").removeClass("collapsing"),e(t).closest("tr").next("tr").addClass("collapse")}),400,t)}else e(".toggle-row").each((function(){if(e(this).closest("tr").next("tr").hasClass("show")){e(this).toggleClass("active"),e(this).closest("tr").next("tr").removeClass("show"),e(this).closest("tr").next("tr").addClass("collapsing");var t=e(this);setTimeout((function(t){e(t).closest("tr").next("tr").removeClass("collapsing"),e(t).closest("tr").next("tr").addClass("collapse")}),400,t)}})),e(this).toggleClass("active"),e(this).closest("tr").next("tr").removeClass("collapse"),e(this).closest("tr").next("tr").addClass("collapsing"),t=e(this),setTimeout((function(t){e(t).closest("tr").next("tr").removeClass("collapsing"),e(t).closest("tr").next("tr").addClass("show")}),100,t)})),e(document).on("change",'select[name="well_pad"]',(function(){e(this).val();var t=e(this).find(":selected").data("lat"),a=e(this).find(":selected").data("long"),o=e(this).find(":selected").data("title");e("input#well_name").val(o),e("input#latitude").val(t),e("input#longitude").val(a),e("input#well_name").addClass("readonly"),e("input#latitude").addClass("readonly"),e("input#longitude").addClass("readonly")})),e(document).on("click","a.approval",(function(){var t="#"+e(this).data("table");t=e(t).parent();var o=[];o.lookupid=e(this).data("lookup"),o.matchid=e(this).data("match"),o.parentid=e(this).data("parent"),o.interaction=e(this).data("action"),o.interactiontype=e(this).data("match-type"),o.dataTable=t,o.rowOpen=e(this).parents().eq(7).data("row-number"),confirm("Are you sure you want to "+o.interaction+" this match?")&&function(t){var o=t.dataTable.find("table").attr("id").split("-")[0];e("."+o+"-loading-indicator").show(),e.ajax({url:"/wp-admin/admin-ajax.php",type:"POST",data:{action:"ajax_approval",lookup_record:t.lookupid,parent_record:t.parentid,match_record:t.matchid,action_status:t.interaction,action_type:t.interactiontype},dataType:"json",beforeSend:function(a){e(t.dataTable).html("")},success:function(o){console.log(o),e(t.dataTable).html(o),a()},complete:function(t){e("."+o+"-loading-indicator").hide()},error:function(t){e("."+o+"-loading-indicator").hide()}})}(o)})),e(document).ready((function(){a()})),e(document).ready((function(){function a(t,e){t.hasClass("collapsing")&&!t.hasClass("show-initial")||(t.css("height",t[0].scrollHeight+"px").removeClass("collapse show show-initial").addClass("collapsing"),t[0].offsetHeight,t.css("height",0).one("transitionend",(function(){t.removeClass("collapsing").addClass("collapse").css("height","")})),e.addClass("collapsed").attr("aria-expanded",!1))}function o(t){return t.replace(/\B(?=(\d{3})+(?!\d))/g,",")}var n,s;jQuery("[data-append-to]").each((function(){var t=jQuery(this),e=t.data("append-to"),a=jQuery(e);a.length?(t.appendTo(a),t.removeAttr("data-append-to"),t.addClass("js-moved")):console.warn("Target element ".concat(e," not found for"),t)})),n=document.getElementById("send-to-dialog"),s=document.querySelectorAll(".send-to-btn"),n&&s.length&&(s.forEach((function(e){var a=e.getAttribute("data-pid"),o=e.getAttribute("data-table-type");e.addEventListener("click",(function(){!function(){var t=document.querySelector(".send-to-dialog");if(t){var e=t.querySelectorAll("input:disabled, select:disabled, textarea:disabled");e&&e.forEach((function(t){t.disabled=!1}))}else console.warn("Send-to dialog not found")}(),function(e,a){if(console.log("actual typeof sPid:",t(e)),console.log("tableType:",a),console.log("Updating send-to form for PID:",e,"in table:",a),void 0!==window.sendToData){if(!window.sendToData[a])return console.warn("No data found for table type:",a),void console.warn("Available table types:",Object.keys(window.sendToData));console.log("Available sendToData keys for",a,":",Object.keys(window.sendToData[a])),console.log("Looking for key:",e,"as string:",String(e),"as number:",Number(e));var o=window.sendToData[a][e]||window.sendToData[a][String(e)]||window.sendToData[a][Number(e)];if(!o)return console.warn("No send-to data found for PID:",e,"in table:",a),void console.warn("Available keys:",Object.keys(window.sendToData[a]));console.log("Form data for PID",e,":",o);var n=document.querySelector(".send-to-dialog");n?Object.keys(o).forEach((function(t){var e=o[t];if("pid"!==t){var a=n.querySelector('[name="'.concat(t,'"]'));a?("checkbox"===a.type?a.checked="1"==e||!0===e||"true"===e:"radio"===a.type?n.querySelectorAll('[name="'.concat(t,'"]')).forEach((function(t){t.value===e&&(t.checked=!0)})):"select"===a.tagName.toLowerCase()?a.value=e:a.value=e||"",console.log("Set field ".concat(t," to:"),e)):console.log("Field ".concat(t," not found in form"))}})):console.warn("Send-to dialog not found")}else console.warn("window.sendToData is not defined")}(a,o),function(){var t=document.querySelector("#send-to-dialog");if(t){var e=!1;["truck_transport_radius","truck_transport_bid","truck_capacity"].forEach((function(a){var o=t.querySelector("#".concat(a));o&&o.value&&""!==o.value.trim()&&"0"!==o.value&&(e=!0)}));var a=t.querySelector("#trucks-checkbox");a&&(a.checked=e);var o=!1;["layflats_transport_radius","layflats_transport_bid","layflats_capacity"].forEach((function(e){var a=t.querySelector("#".concat(e));a&&a.value&&""!==a.value.trim()&&"0"!==a.value&&(o=!0)}));var n=t.querySelector("#layflats-checkbox");n&&(n.checked=o,console.log("Set layflats checkbox to:",o))}else console.warn("Send-to dialog not found")}(),n.showModal()}))})),n.querySelectorAll(".dialog-closer").forEach((function(t){t.onclick=function(){n.close()}}))),e(".accordion-button").on("click",(function(){var t=e(this).attr("data-bs-target"),o=e(t),n=e(this);o.hasClass("show")||o.hasClass("show-initial")?a(o,n):(function(t,e){if(!t.hasClass("collapsing")&&!t.hasClass("show")&&!t.hasClass("show-initial")){t.removeClass("collapse").addClass("collapsing").css("height",0),t[0].offsetHeight;var a=t[0].scrollHeight;t.css("height",a+"px").one("transitionend",(function(){t.removeClass("collapsing").addClass("collapse show").css("height","")})),e.removeClass("collapsed").attr("aria-expanded",!0)}}(o,n),function(t){e(".accordion-collapse").not(t).each((function(){var t=e(this),o=e('[data-bs-target="#'+t.attr("id")+'"]');t&&o&&a(t,o)}))}(o))})),e(".checkbox").change((function(){var t=e(this).is(":checked");e(this).closest(".watersharing-row").find('input[type="number"]').prop("disabled",!t)})),e(".checkbox").each((function(){var t=e(this).attr("class").split(" ").find((function(t){return t.includes("trade_supply")||t.includes("trade_demand")}));t&&e(this).closest(".watersharing-row").find('input[type="number"][class*="'.concat(t.split("-")[0],'"]')).prop("disabled",!0)})),e(".trade_supply-bid_amount, .trade_supply-rate_bpd, .trade_supply-bid_units, .trade_demand-bid_amount, .trade_demand-rate_bpd, .trade_demand-bid_units").change((function(){var t=e(this).hasClass("trade_supply-bid_amount")||e(this).hasClass("trade_supply-rate_bpd")||e(this).hasClass("trade_supply-bid_units")?"trade_supply-":"trade_demand-",a=e("."+t+"bid_amount"),n=e("."+t+"rate_bpd"),s=e("."+t+"bid_units"),l=e("."+t+"totalval"),i=e("."+t+"specval"),r=parseFloat(a.val()),d=parseFloat(n.val()),c=s.val();isNaN(r)||isNaN(d)||null==c?(l.val(""),i.val("")):"USD/bbl.day"==c?(l.val(o((r*d).toFixed(2))),i.val(o(r.toFixed(2)))):(l.val(o(r.toFixed(2))),i.val(o((r/d).toFixed(2))))}))})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".chart-container").forEach((function(t){var e=t.getAttribute("data-block-id"),a=JSON.parse(t.getAttribute("data-chart-data")),o=document.getElementById("stat-chart-".concat(e));if(o&&a){var n=o.getContext("2d"),s=a.map((function(t){return t.volume})),l=a.map((function(t){return t.date}));new Chart(n,{type:"line",data:{labels:l,datasets:[{label:"Ongoing trades",data:s,borderWidth:1}]},options:{scales:{y:{beginAtZero:!0,title:{display:!0,text:"Volume(bbl)"}}},plugins:{legend:{display:!1},title:{display:!0,text:"Ongoing Trades",font:{size:20,weight:"bold"}},tooltip:{enabled:!1}},responsive:!0,maintainAspectRatio:!1}})}})),e(document).on("click",".download-summary-btn",(function(t){t.preventDefault();var a=e(this).data("tradeCsv");e.ajax({url:my_ajax_object.ajax_url,method:"POST",data:{action:"download_latest_summary",trade_csv:a},xhrFields:{responseType:"blob"},success:function(t){if(t instanceof Blob&&t.size){var e=window.URL.createObjectURL(t),o=document.createElement("a");o.style.display="none",o.href=e,o.download=a+" Summary.csv",document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(e)}else console.error("Invalid or empty Blob response:",t),alert("The file could not be downloaded.")},error:function(t,e,a){console.error("AJAX error:",e,a),alert("Could not download the file. May be missing or empty, please try again.")}})})),jQuery})),window.downloadCsv=function(t,e){var a=new FormData;a.append("action","download_csv"),a.append("csv_data",JSON.stringify(e)),fetch(t,{method:"POST",body:a}).then((function(t){if(t.ok)return t.blob();throw new Error("Network response was not ok.")})).then((function(t){var e=window.URL.createObjectURL(t),a=document.createElement("a");a.style.display="none",a.href=e,a.download="trades_data.csv",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(e)})).catch((function(t){return console.error("There was an error with the download:",t)}))}}(jQuery)})();